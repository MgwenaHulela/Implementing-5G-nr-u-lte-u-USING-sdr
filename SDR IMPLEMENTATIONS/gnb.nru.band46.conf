

Active_gNBs = ( "gNB-OAI");
Asn1_verbosity = "none";

gNBs =
(
 {
     gNB_ID    =  0xe00;
     gNB_name  =  "gNB-OAI";
        NRU = {
   	enabled               = 1;
   	mode                  = "LBE";          # Use Load-Based Equipment (sensing mode)
   	ed_threshold_dbm      = -60;            # Energy detection threshold (try -70 dBm first)
   	ed_sensing_time_us    = 500;            # Time spent sensing before TX (Âµs)
   	cw_min                = 15;             # Contention window min
   	cw_max                = 1023;           # Contention window max
   	mcot_ms               = 6;              # Max channel occupancy time (ms)
   	log_lbt               = 1;              # Enable detailed logs & dashboard
   	
   	frame_period_ms       = 10;        # Full frame duration (e.g., 10 ms)
   	tx_window_ms          = 10;         # Active transmission window
   	jitter_us             = 100;
   	duty_cycle_percent    = 90;
};
     tracking_area_code  =  40960;
     plmn_list = ({ mcc = 001; mnc = 01; mnc_length = 2; snssaiList = ({ sst = 1; sd = "000001"; }) });
     nr_cellid = 0xe00;
     

     do_CSIRS = 1;
     do_SRS = 1;
     do_SIB1 = 1;


     servingCellConfigCommon = (
     {
       physCellId = 0;
       cellBarred = "notBarred";

       # BAND 46 - MANUAL CONFIGURATION (REQUIRED)
       absoluteFrequencySSB = 745440;      
       dl_frequencyBand = 46;
       dl_absoluteFrequencyPointA = 744774; 
       
       dl_offstToCarrier = 0;
       dl_subcarrierSpacing = 1;
       dl_carrierBandwidth = 51;
       
       initialDLBWPlocationAndBandwidth = 14025;
       initialDLBWPsubcarrierSpacing = 1;
       initialDLBWPcontrolResourceSetZero = 12;
       initialDLBWPsearchSpaceZero = 0;

       ul_frequencyBand = 46;
       ul_offstToCarrier = 0;
       ul_subcarrierSpacing = 1;
       ul_carrierBandwidth = 51;
       pMax = 20;
       
       initialULBWPlocationAndBandwidth = 14025;
       initialULBWPsubcarrierSpacing = 1;
       
       prach_ConfigurationIndex = 16;
       prach_msg1_FDM = 0;
       prach_msg1_FrequencyStart = 40;
       zeroCorrelationZoneConfig = 1;
       preambleReceivedTargetPower = -104;
       preambleTransMax = 6;
       powerRampingStep = 1;
       ssb_perRACH_OccasionAndCB_PreamblesPerSSB_PR = 1;
       ssb_perRACH_OccasionAndCB_PreamblesPerSSB = 8;
       ra_ContentionResolutionTimer = 7;
       rsrp_ThresholdSSB = 19;
       prach_RootSequenceIndex_PR = 1;
       prach_RootSequenceIndex = 0;
       msg1_SubcarrierSpacing = 1;
       restrictedSetConfig = 0;
       msg3_DeltaPreamble = 1;
       p0_NominalWithGrant = -90;
       pucchGroupHopping = 0;
       hoppingId = 40;
       p0_nominal = -90;
       ssb_PositionsInBurst_Bitmap = 0x01;
       ssb_periodicityServingCell = 2;
       dmrs_TypeA_Position = 0;
       subcarrierSpacing = 1;
       referenceSubcarrierSpacing = 1;
       dl_UL_TransmissionPeriodicity = 6;
       nrofDownlinkSlots = 7;
       nrofDownlinkSymbols = 6;
       nrofUplinkSlots = 2;
       nrofUplinkSymbols = 4;
       ssPBCH_BlockPower = 3;
       
       
     }
     );
     RACH = {
    total_number_of_ra_preambles                    = 64;
    ssb_perRACH_OccasionAndCB_PreamblesPerSSB_PR    = 1;
    ssb_perRACH_OccasionAndCB_PreamblesPerSSB       = 8;
    prach_root_sequence_index                       = 1;
    prach_configuration_index                       = 16;
    msg1_fdm                                        = 1;
    msg1_frequency_start                            = 0;
    zero_correlation_zone_config                    = 8;
    preamble_received_target_power                  = -110;
    preamble_trans_max                              = 10;
    power_ramping_step                              = 2;
    ra_ContentionResolutionTimer                    = 8;
    msg3_DeltaPreamble                              = 1;
    restrictedSetConfig                             = 0;
};

      
     SCTP : {
       SCTP_INSTREAMS  = 2;
       SCTP_OUTSTREAMS = 2;
     };

     amf_ip_address = ({ ipv4 = "192.168.70.129"; });

     NETWORK_INTERFACES : {
       GNB_IPV4_ADDRESS_FOR_NG_AMF = "192.168.70.129";
       GNB_IPV4_ADDRESS_FOR_NGU = "192.168.70.129";
       GNB_PORT_FOR_S1U = 2153;
     };
   }
);

MACRLCs = (
{
  num_cc = 1;
  tr_s_preference = "local_L1";
  tr_n_preference = "local_RRC";
  pusch_TargetSNRx10 = 150;
  pucch_TargetSNRx10 = 200;
}
);

L1s = (
{
  num_cc = 1;
  tr_n_preference = "local_mac";
  prach_dtx_threshold = 120;
  pucch0_dtx_threshold = 100;
  ofdm_offset_divisor = 8;
}
);

RUs = (
{
  local_rf = "yes";
  nb_tx = 1;
  nb_rx = 1;

  att_tx = 1;           # Reduced TX attenuation
  #tt_rx = 1;            # REMOVE RX ATTENUATION - this was blocking signals!
  max_rxgain = 110;       # Allow maximum gain
  rx_gain = 60;          # ADD THIS: Set explicit RX gain
  tx_gain = 90; 
  sample_rate = 30.72e6;
  master_clock_rate = 30.72e6;
          # Explicit TX gain
  
  bands = [46];
  max_pdschReferenceSignalPower = -3;
  eNB_instances = [0];

  sdr_addrs = "type=b200,serial=326F3E8,num_recv_frames=1024,recv_frame_size=7680,num_channels=1,master_clock_rate=15.36e6,wire_format=sc8";

  clock_src = "internal";
}
);

# rfsimulator section should be commented out or removed
rfsimulator = {
  serveraddr = "server";
  serverport = "4043";
};
security = {
  ciphering_algorithms = ( "nea0" );
  integrity_algorithms = ( "nia2", "nia0" );
  drb_ciphering = "yes";
  drb_integrity = "no";
};

log_config : {
  global_log_level = "info";
  hw_log_level = "info";
  phy_log_level = "info";
  mac_log_level = "info";
  rlc_log_level = "info";
  pdcp_log_level = "info";
  rrc_log_level = "info";
  ngap_log_level = "debug";
  f1ap_log_level = "debug";
};


# --- new NR-U block (custom extension) ---
# Add this to your gNB configuration file

e2_agent = {
  near_ric_ip_addr = "127.0.0.1";
  sm_dir = "/usr/local/lib/flexric/";
};
